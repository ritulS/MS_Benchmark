version: '3.3'
services:
  portainer:
    image: portainer/portainer-ce:latest
    container_name: portainer
    restart: always
    ports:
    - 8000:9000
    volumes:
    - /var/run/docker.sock:/var/run/docker.sock
    - portainer_data:/data
    networks:
    - mewbie_network
    deploy:
      placement:
        constraints:
        - node.role == manager
  MewbieClient:
    image: mewbieregistry.com:5000/mewbie_img:latest
    container_name: mewbie_client
    volumes:
    - ./enrichment_runs/test_run/all_trace_packets.json:/app/all_trace_packets.json
    - ./deployment_files/mewbie_client/mewbie_client.go:/app/mewbie_client.go
    - ritul_logs:/app/logs/
    environment:
    - CONTAINER_NAME=mewbie_client
    - WORKLOAD_NAME=test_run
    - SL_NODES=n2134,n942,n4202,n1765,n3827,n3756,n4376,n5182,n6286,n1725,n4408,n8216,n6096,n4294,n2415,n6952,n7510,n1220,n6779,n7144,n4578,n776,n668,n5871,n1604,n6689,n7370,n4912,n3703,n366,n1962,n3432,n945,n2172,n165,n7964,n7045,n4748,n1011,n7924,n6342,n2003,n5510,n3820,n5735,n8167,n1990,n812,n486,n1581,n5015,n4923,n5155,n4864,n6141,n1860,n6973,n6068,n7092,n7006,n7356,n2977,n6697,n1513,n6486,n2685,n7918,n7731,n5601,n6790,n4709,n2759,n5541,n1148,n1287,n1606,n8147,n3549,n8049,n272,n8275,n1417,n6576,n1407,n6281,n3127,n3941,n2609,n2826,n1076,n8261,n3674,n4310,n2436,n2029,n5790,n7642,n2630,n8030,n630,n6255,n4690,n5559,n423,n4850,n1747,n2526,n2409,n5703,n2502,n7352,n704,n3634,n3395,n1875,n2068,n6042,n3622,n6109,n8032,n3411,n1964,n3734,n5912,n3907,n1850,n3534,n4101,n7551,n5323,n5899,n3960,n4726,n8188,n3404,n1225,n3951,n7994,n309,n4260,n2868,n5402,n2663,n2838,n287,n2309,n5775,n6693,n158,n2888,n3441,n6212,n2882,n3392,n1595,n2354,n1410,n1662,n4189,n5500,n6678,n7266,n1673,n2484,n3247,n2857,n7549,n2661,n8132,n7044,n7206,n1333,n5064,n4410,n205,n3599,n5447,n7960,n341,n1914,n3492,n1937,n5481,n5459,n3727,n5081,n4797,n1748,n1021,n1868,n7475,n2769,n895,n9,n2587,n224,n7200,n6076,n1439,n728,n3155,n572,n3803,n4450,n8307,n7900,n1562,n3826,n2637,n4482,n2929,n4388,n1928,n5829,n3460,n4067,n6378,n6487,n136,n6899,n5401,n6171,n6111,n127,n5691,n218,n3223,n2492,n6232,n4509,n2784,n5482,n2119,n3514,n8005,n2222,n2036,n2557,n6300,n418,n4800,n3921,n2458,n2756,n7982,n377,n1685,n2599,n599,n5778,n804,n4927,n3682,n5406,n7421,n2744,n1041,n2521,n4904,n8290,n1479,n5171,n8221,n7440,n6840,n4426,n6563,n4667,n8082,n1459,n7253,n358,n6617,n5724,n7153,n263,n772,n4660,n2341,n6660,n4063,n995,n7831,n4815,n5083,n7595,n7567,n2444,n5657,n6573,n2158,n3989,n4715,n5681,n6282,n6977,n2327,n2083,n4868,n7870,n4490,n7695,n7016,n5856,n5227,n6516,n5095,n7482,n8176,n7084,n5774,n1608,n1787,n2734,n3297,n2950,n3754,n7455,n6650,n2273,n4610,n5259,n2177,n7826,n4124,n6420,n7565,n3022,n2413,n3221,n4500,n6224,n824,n6046,n6248,n7203,n785,n8146,n7576,n2819,n896,n3779,n4162,n1911,n5986,n2530,n1361,n4156,n615,n4223,n5598,n73,n3508,n7361,n2453,n1200,n1357,n2289,n2764,n4558,n7290,n3888,n5416,n66,n1119,n227,n7456,n3291,n7796,n4703,n2439,n7070,n4030,n7350,n3570,n3078,n6774,n7033,n4843,n645,n2194,n7113,n967,n6035,n4592,n5206,n4909,n7734,n1343,n8286,n2728,n3613,n5008,n3694,n6670,n1436,n1412,n622,n1297,n7547,n4937,n3427,n903,n4975,n6974,n1985,n1749,n231,n5925,n6918,n2230,n3636,n3772,n5952,n8081,n6969,n434,n1480,n3334,n4550,n5971,n2291,n6648,n5732,n7248,n6469,n988,n7666,n421,n6986,n3642,n1554,n8085,n7061,n6454,n2649,n4365,n4750,n4324,n1033,n1389,n2739,n6134,n5556,n5508,n5317,n4824,n5247,n3148,n5628,n876,n7691,n6268,n429,n2136,n6223,n8037,n760,n2634,n4770,n1270,n4300,n1485,n8250,n138,n4680,n6803,n7422,n1944,n7476,n863,n6382,n3897,n412,n5410,n5004,n132,n6014,n2996,n2224,n3207,n1026,n2416,n2250,n4226,n6531,n7555,n3114,n6800,n6182,n6474,n681,n7222,n8301,n3035
    command: sh -c "tail -f /dev/null"
    networks:
    - mewbie_network
    deploy:
      placement:
        constraints:
        - node.role == manager
  Postgres-0_n8216:
    image: mewbieregistry.com:5000/postgres_mewbie_img:latest
    container_name: n8216
    networks:
      mewbie_network:
        aliases:
        - n8216
    environment:
    - POSTGRES_USER=pguser
    - POSTGRES_PASSWORD=pgpass
    - POSTGRES_DB=pg_db
    - POSTGRES_HOST_AUTH_METHOD=trust
    - IS_REPLICA=false
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 2G
  Postgres-0_n8216-replica-0:
    image: mewbieregistry.com:5000/postgres_mewbie_img:latest
    container_name: n8216-replica-0
    networks:
      mewbie_network:
        aliases:
        - Postgres-0_n8216
    environment:
    - POSTGRES_USER=pguser
    - POSTGRES_PASSWORD=pgpass
    - POSTGRES_DB=pg_db
    - POSTGRES_HOST_AUTH_METHOD=trust
    - REPLICATE_FROM=n8216
    - IS_REPLICA=true
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 2G
    depends_on:
    - Postgres-0_n8216
  Python-0_n4408:
    image: mewbieregistry.com:5000/slp_img:latest
    container_name: n4408
    volumes:
    - ritul_logs:/app/logs/
    environment:
    - CONTAINER_NAME=n4408
    networks:
      mewbie_network:
        aliases:
        - n4408
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 5G
  Python-1_n2134:
    image: mewbieregistry.com:5000/slp_img:latest
    container_name: n2134
    volumes:
    - ritul_logs:/app/logs/
    environment:
    - CONTAINER_NAME=n2134
    networks:
      mewbie_network:
        aliases:
        - n2134
    deploy:
      replicas: 2
      placement:
        constraints:
        - node.labels.sl_node == true
      resources:
        limits:
          cpus: '3'
          memory: 5G
  Python-2_n1725:
    image: mewbieregistry.com:5000/slp_img:latest
    container_name: n1725
    volumes:
    - ritul_logs:/app/logs/
    environment:
    - CONTAINER_NAME=n1725
    networks:
      mewbie_network:
        aliases:
        - n1725
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 5G
networks:
  mewbie_network:
    driver: overlay
    ipam:
      config:
      - subnet: 10.20.0.0/16
volumes:
  ritul_logs: {}
  portainer_data:
    driver: local
